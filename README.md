# Микросервисная система новостного портала

Этот проект представляет собой микросервисную систему для новостного портала, состоящую из двух сервисов:

1. **API Gateway** - шлюз для работы с новостями и комментариями (заглушки)
2. **Сервис комментариев** - полноценный сервис управления комментариями

## Структура проекта

```
/workspace
├── APIGateway/          # API Gateway с заглушками
│   ├── cmd/
│   │   └── server/
│   │       └── main.go
│   ├── internal/
│   │   ├── handler/
│   │   ├── model/
│   │   └── server/
│   ├── go.mod
│   └── README.md
├── CommentService/      # Сервис комментариев
│   ├── cmd/
│   │   └── server/
│   │       └── main.go
│   ├── internal/
│   │   ├── handler/
│   │   ├── model/
│   │   ├── repository/
│   │   ├── service/
│   │   ├── moderator/
│   │   └── server/
│   ├── migrations/
│   ├── docker-compose.yml
│   ├── go.mod
│   └── README.md
└── README.md            # Этот файл
```

## Требования

- Go 1.21+
- Docker и Docker Compose (для сервиса комментариев)
- PostgreSQL (для сервиса комментариев)

## Запуск API Gateway

API Gateway запускается на порту 8080 и предоставляет заглушки для интеграции с фронтендом.

1. Перейдите в директорию API Gateway:
```bash
cd APIGateway
```

2. Установите зависимости:
```bash
go mod tidy
```

3. Запустите сервер:
```bash
go run cmd/server/main.go
```

Сервер будет доступен по адресу: `http://localhost:8080`

### Эндпоинты API Gateway

- `GET /api/v1/news` - список новостей
- `GET /api/v1/news/filter` - фильтр новостей
- `GET /api/v1/news/{id}` - детальная новость
- `POST /api/v1/news/{id}/comments` - добавление комментария к новости

## Запуск сервиса комментариев

Сервис комментариев запускается на порту 8081 и предоставляет полную функциональность для управления комментариями.

1. Перейдите в директорию сервиса комментариев:
```bash
cd CommentService
```

2. Установите зависимости:
```bash
go mod tidy
```

3. Запустите базу данных с помощью Docker:
```bash
docker-compose up -d postgres
```

4. Дождитесь запуска базы данных и выполнения миграций

5. Запустите сервер:
```bash
go run cmd/server/main.go
```

Сервер будет доступен по адресу: `http://localhost:8081`

### Эндпоинты сервиса комментариев

- `POST /api/v1/comments` - создание комментария
- `GET /api/v1/comments/news/{news_id}` - комментарии к новости

## Особенности реализации

### API Gateway
- Реализован как заглушка для интеграции с фронтендом
- Возвращает статичные данные для тестирования
- Поддерживает все необходимые эндпоинты
- Включает валидацию входных данных

### Сервис комментариев
- Полноценная работа с базой данных PostgreSQL
- Поддержка иерархических комментариев
- Асинхронная модерация комментариев
- Проверка на запрещенные слова: `qwerty`, `йцукен`, `zxcvbnm`
- Graceful shutdown
- Пагинация и фильтрация (в рамках требований)

## Примеры использования

### Получить список новостей через API Gateway:
```bash
curl http://localhost:8080/api/v1/news
```

### Добавить комментарий к новости:
```bash
curl -X POST http://localhost:8080/api/v1/news/1/comments \
  -H "Content-Type: application/json" \
  -d '{"author": "Иван", "content": "Отличная новость!"}'
```

### Создать комментарий напрямую в сервисе комментариев:
```bash
curl -X POST http://localhost:8081/api/v1/comments \
  -H "Content-Type: application/json" \
  -d '{
    "news_id": 123,
    "parent_id": null,
    "author": "Пользователь",
    "content": "Текст комментария"
  }'
```

### Получить комментарии к новости:
```bash
curl http://localhost:8081/api/v1/comments/news/123
```

## Архитектурные решения

1. **Разделение ответственности**: API Gateway отвечает за интеграцию с фронтендом, а сервис комментариев - за бизнес-логику и хранение данных.

2. **Модульная архитектура**: Каждый сервис использует слоистую архитектуру (handler, service, repository, model).

3. **Асинхронная модерация**: Комментарии проверяются на наличие запрещенных слов в фоновом режиме.

4. **Безопасность**: Все входные данные валидируются, используются параметризованные запросы к БД.

5. **Отказоустойчивость**: Реализован graceful shutdown для корректной остановки сервисов.